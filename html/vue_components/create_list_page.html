<template id="create-list-page-template">
	<div class="container mt-2">
	<div v-if="!user().is_logged_in" class="row" tt="log_in_for_actions">
	</div>
	<div v-if="user().is_logged_in" class="row">
		<div class="col-md-12">
			<h1 tt="create_new_list"></h1>
			<form @submit.prevent="submit_form" class="form-inline">
				<div>
					<span tt="name"></span>
					<input type="text" class="form-control" v-model="name" tt_placeholder="new_list_name" style="width:15rem" />
				</div>
				<input type="submit" :class="'btn btn-outline-primary'+(header_schema_id==0?' disabled':'')" tt_value="create_new_list" />
				<span v-if="message!=''" style="margin-left:1rem; color:red;">
					{{message}}
				</span>
			</form>
		</div>
	</div>
	<div class="row" v-if="user().is_logged_in && header_schemas.length>0" style="margin-top: 2rem;">
		<div class="col-md-12">
			<div style="float: right;">
				<router-link class="btn btn-outline-success" to="/create/header" tt="create_new_header"></router-link>
			</div>
			<h2 tt="header_schemas"></h2>
			<div style="max-height: 30rem; overflow: auto;">
				<table class="table">
					<tr v-for="hs in header_schemas">
						<td>
							<input type="radio" v-model="header_schema_id" :value="hs.id" />
						</td>
						<td>{{hs.name}}</td>
						<td v-for='col in hs.columns'>
							<div v-for="(v,k) in col">
								<b>{{k.replace(/_/g,' ')}}</b>: {{v}}
							</div>
						</td>
					</tr>
				</table>
			</div>
		</div>
	</div>
	</div>
</template>
	
<script>
"use strict";


let CreateListPage = Vue.extend ( {
	props : ["list_or_new"] ,
	data : function () { return { name:"" , header_schemas:[] , header_schema_id:0 , message:'' } } ,
	created : function () {
		this.load_header_schemas();
	},
	updated : function () { tt.updateInterface(this.$el) } ,
	mounted : function () { tt.updateInterface(this.$el) } ,
	methods : {
		submit_form() {
			this.name = this.name.trim();
			if ( this.name=="" ) {
				this.message = tt.t("name_required") ;
				return ;
			}
			if ( this.header_schema_id==0 ) {
				this.message = tt.t("header_schema_required");
				return ;
			}
			this.message = "";
    		let url = "/list/new?name="+encodeURIComponent(this.name)+"&header_schema_id="+this.header_schema_id;
            fetch(url)
                .then((response) => response.json())
                .then((d) => {
                	if (d.status=="OK") {
                		let list_id = d.data;
                		this.$router.push ("/list/"+list_id);
                	} else {
                		alert(d.status);
                	}
                })
		},
		load_header_schemas() {
    		let url = "/header/schemas";
            fetch(url)
                .then((response) => response.json())
                .then((d) => {
                	this.header_schemas = d.data;
                })
		},
		user() { return user??{is_logged_in:false} }
	} ,
	template:"#create-list-page-template"
} );
</script>